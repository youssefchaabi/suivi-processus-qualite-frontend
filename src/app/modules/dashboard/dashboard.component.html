<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1 class="dashboard-title">
          <mat-icon class="title-icon">dashboard</mat-icon>
          Tableau de Bord
        </h1>
        <p class="dashboard-subtitle">
          Bienvenue, <strong>{{ currentUser?.nom || 'Utilisateur' }}</strong>
          <span class="role-badge" [ngClass]="'role-' + userRole">{{ userRole }}</span>
        </p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="createFiche()" class="action-btn">
          <mat-icon>add</mat-icon>
          Nouvelle Fiche
        </button>
        <button mat-icon-button (click)="refreshDashboard()" matTooltip="Actualiser">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des données...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="dashboard-content">
    
    <!-- Stats Cards Section -->
    <div class="stats-grid">
      <!-- Card 1: Total Fiches -->
      <mat-card class="stat-card card-primary" (click)="navigateToFiches()">
        <mat-card-content>
          <div class="stat-icon-wrapper primary-gradient">
            <mat-icon class="stat-icon">description</mat-icon>
          </div>
          <div class="stat-details">
            <h3 class="stat-value">{{ totalFichesQualite }}</h3>
            <p class="stat-label">Fiches Qualité</p>
            <span class="stat-trend positive">
              <mat-icon>trending_up</mat-icon>
              +12% ce mois
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Card 2: Fiches En Cours -->
      <mat-card class="stat-card card-warning" (click)="navigateToFiches()">
        <mat-card-content>
          <div class="stat-icon-wrapper warning-gradient">
            <mat-icon class="stat-icon">pending_actions</mat-icon>
          </div>
          <div class="stat-details">
            <h3 class="stat-value">{{ fichesEnCours }}</h3>
            <p class="stat-label">En Cours</p>
            <span class="stat-trend neutral">
              <mat-icon>remove</mat-icon>
              Stable
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Card 3: Taux de Conformité -->
      <mat-card class="stat-card card-success">
        <mat-card-content>
          <div class="stat-icon-wrapper success-gradient">
            <mat-icon class="stat-icon">verified</mat-icon>
          </div>
          <div class="stat-details">
            <h3 class="stat-value">{{ tauxConformite }}%</h3>
            <p class="stat-label">Conformité</p>
            <span class="stat-trend positive">
              <mat-icon>trending_up</mat-icon>
              +5% ce mois
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Card 4: Projets Actifs -->
      <mat-card class="stat-card card-info" (click)="navigateToProjets()">
        <mat-card-content>
          <div class="stat-icon-wrapper info-gradient">
            <mat-icon class="stat-icon">folder_open</mat-icon>
          </div>
          <div class="stat-details">
            <h3 class="stat-value">{{ projetsActifs }}</h3>
            <p class="stat-label">Projets Actifs</p>
            <span class="stat-trend positive">
              <mat-icon>trending_up</mat-icon>
              +3 nouveaux
            </span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid">
      <!-- Evolution Chart -->
      <mat-card class="chart-card evolution-chart">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>show_chart</mat-icon>
            Évolution Mensuelle
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas baseChart
              [data]="evolutionChartData"
              [options]="lineChartOptions"
              [type]="lineChartType">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Statut Chart -->
      <mat-card class="chart-card statut-chart">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>donut_large</mat-icon>
            Répartition par Statut
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas baseChart
              [data]="statutChartData"
              [options]="doughnutChartOptions"
              [type]="doughnutChartType">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Performance Chart -->
    <div class="full-width-section">
      <mat-card class="chart-card performance-chart">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>bar_chart</mat-icon>
            Performance par Type de Fiche
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas baseChart
              [data]="performanceChartData"
              [options]="barChartOptions"
              [type]="barChartType">
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Bottom Section: Activities & Quick Actions -->
    <div class="bottom-grid">
      <!-- Recent Activities -->
      <mat-card class="activities-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>history</mat-icon>
            Activités Récentes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="activities-list">
            <div *ngFor="let activity of recentActivities" class="activity-item">
              <div class="activity-icon" [ngClass]="'icon-' + activity.color">
                <mat-icon>{{ activity.icon }}</mat-icon>
              </div>
              <div class="activity-content">
                <h4 class="activity-title">{{ activity.title }}</h4>
                <p class="activity-description">{{ activity.description }}</p>
                <span class="activity-meta">
                  <mat-icon class="meta-icon">person</mat-icon>
                  {{ activity.user }} • {{ activity.time }}
                </span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Quick Actions -->
      <mat-card class="quick-actions-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>flash_on</mat-icon>
            Actions Rapides
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="quick-actions-grid">
            <button mat-raised-button class="quick-action-btn primary-action" (click)="createFiche()">
              <mat-icon>add_circle</mat-icon>
              <span>Créer Fiche Qualité</span>
            </button>
            <button mat-raised-button class="quick-action-btn secondary-action" (click)="createProjet()">
              <mat-icon>create_new_folder</mat-icon>
              <span>Nouveau Projet</span>
            </button>
            <button mat-raised-button class="quick-action-btn tertiary-action" (click)="viewReports()">
              <mat-icon>assessment</mat-icon>
              <span>Voir Rapports</span>
            </button>
            <button mat-raised-button class="quick-action-btn quaternary-action" (click)="manageNotifications()">
              <mat-icon>notifications_active</mat-icon>
              <span>Notifications</span>
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
