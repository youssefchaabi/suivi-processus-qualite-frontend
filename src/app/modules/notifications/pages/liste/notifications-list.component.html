<mat-card>
  <mat-card-title>Notifications</mat-card-title>
  <div class="filters" style="display:flex; gap:12px; margin: 8px 0 16px; flex-wrap: wrap; align-items:center;">
    <mat-slide-toggle [(ngModel)]="showAll" (change)="reload()" *ngIf="auth.getRole() === 'ADMIN' || auth.getRole() === 'PILOTE_QUALITE'">
      Voir toutes les notifications
    </mat-slide-toggle>
    <mat-form-field appearance="outline">
      <mat-label>Type</mat-label>
      <mat-select [(ngModel)]="filterType" (selectionChange)="reload()">
        <mat-option value="">Tous</mat-option>
        <mat-option value="FICHE_QUALITE">Fiche Qualité</mat-option>
        <mat-option value="FICHE_SUIVI">Fiche Suivi</mat-option>
        <mat-option value="RETARD">Retard</mat-option>
        <mat-option value="ALERTE">Alerte</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>État</mat-label>
      <mat-select [(ngModel)]="filterEtat" (selectionChange)="reload()">
        <mat-option value="">Tous</mat-option>
        <mat-option value="NLU">Non lue</mat-option>
        <mat-option value="LU">Lue</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div class="table-wrapper">
    <table mat-table [dataSource]="data" class="mat-elevation-z1 full-width">

      <ng-container matColumnDef="message">
        <th mat-header-cell *matHeaderCellDef> Message </th>
        <td mat-cell *matCellDef="let row"> {{ row.message }} </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Type </th>
        <td mat-cell *matCellDef="let row">
          <mat-chip color="primary">{{ getTypeLabel(row.type) }}</mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="dateCreation">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let row"> {{ row.dateCreation | date:'short' }} </td>
      </ng-container>

      <ng-container matColumnDef="etat">
        <th mat-header-cell *matHeaderCellDef> État </th>
        <td mat-cell *matCellDef="let row">
          <mat-chip [color]="row.lu ? 'accent' : 'warn'"> {{ row.lu ? 'Lue' : 'Non lue' }} </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let row">
          <button mat-icon-button (click)="markAsRead(row)" [disabled]="row.lu" matTooltip="Marquer comme lue">
            <mat-icon>done</mat-icon>
          </button>
          <button mat-icon-button (click)="relancer(row)" [disabled]="row.lu" matTooltip="Relancer par e-mail">
            <mat-icon>send</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="delete(row)" matTooltip="Supprimer">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div *ngIf="data.length === 0" class="empty-state">
      Aucune notification.
    </div>
  </div>
</mat-card>


