<div class="ai-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>
      <mat-icon>psychology</mat-icon>
      Dashboard IA - Pilote Qualité
    </h1>
    <p class="subtitle">Analyses prédictives et recommandations intelligentes pour optimiser la qualité</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Analyse IA en cours...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">
    
    <!-- Métriques IA -->
    <div class="ai-metrics-grid">
      <mat-card class="ai-metric-card">
        <mat-card-content>
          <div class="metric-content">
            <div class="metric-icon" [style.background-color]="getScoreIAColor()">
              <mat-icon>smart_toy</mat-icon>
            </div>
            <div class="metric-info">
              <h3 class="metric-value">{{ scoreIA | number:'1.0-0' }}</h3>
              <p class="metric-title">Score IA</p>
              <p class="metric-description">Qualité des analyses prédictives</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="ai-metric-card">
        <mat-card-content>
          <div class="metric-content">
            <div class="metric-icon" [style.background-color]="getNiveauConfianceColor()">
              <mat-icon>verified</mat-icon>
            </div>
            <div class="metric-info">
              <h3 class="metric-value">{{ niveauConfiance | number:'1.0-0' }}%</h3>
              <p class="metric-title">Confiance IA</p>
              <p class="metric-description">Fiabilité des prédictions</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="ai-metric-card">
        <mat-card-content>
          <div class="metric-content">
            <div class="metric-icon" style="background-color: #f44336;">
              <mat-icon>warning</mat-icon>
            </div>
            <div class="metric-info">
              <h3 class="metric-value">{{ alertesCritiques }}</h3>
              <p class="metric-title">Alertes Critiques</p>
              <p class="metric-description">Risques identifiés par l'IA</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="ai-metric-card">
        <mat-card-content>
          <div class="metric-content">
            <div class="metric-icon" style="background-color: #2196f3;">
              <mat-icon>auto_awesome</mat-icon>
            </div>
            <div class="metric-info">
              <h3 class="metric-value">{{ opportunitesOptimisation }}</h3>
              <p class="metric-title">Optimisations</p>
              <p class="metric-description">Opportunités d'amélioration</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Analyses IA -->
    <div class="ai-analyses-section">
      
      <!-- Prédictions de risques -->
      <div class="analysis-row">
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>security</mat-icon>
              Prédictions de Risques
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="predictions-list" *ngIf="predictionsRisques.length > 0; else noPredictions">
              <div *ngFor="let prediction of predictionsRisques" class="prediction-item">
                <div class="prediction-header">
                  <div class="risk-level" [style.background-color]="getNiveauRisqueColor(prediction.niveau)">
                    {{ prediction.niveau }}
                  </div>
                  <div class="probability">{{ (prediction.probabilite * 100) | number:'1.0-0' }}%</div>
                </div>
                <p class="prediction-description">{{ prediction.description }}</p>
                <p class="prediction-impact"><strong>Impact:</strong> {{ prediction.impact }}</p>
                <div class="recommendations">
                  <h4>Recommandations:</h4>
                  <ul>
                    <li *ngFor="let rec of prediction.recommandations">{{ rec }}</li>
                  </ul>
                </div>
              </div>
            </div>
            <ng-template #noPredictions>
              <p class="no-data">Aucun risque critique détecté</p>
            </ng-template>
          </mat-card-content>
        </mat-card>

        <!-- Recommandations IA -->
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>lightbulb</mat-icon>
              Recommandations IA
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="recommendations-list" *ngIf="recommandations.length > 0; else noRecommendations">
              <div *ngFor="let rec of recommandations" class="recommendation-item">
                <div class="rec-header">
                  <div class="rec-type" [style.background-color]="getTypeRecommandationColor(rec.type)">
                    {{ rec.type }}
                  </div>
                  <div class="rec-priority">Priorité: {{ rec.priorite }}</div>
                </div>
                <h4 class="rec-title">{{ rec.titre }}</h4>
                <p class="rec-description">{{ rec.description }}</p>
                <div class="rec-actions">
                  <h5>Actions:</h5>
                  <ul>
                    <li *ngFor="let action of rec.actions">{{ action }}</li>
                  </ul>
                </div>
                <div class="rec-impact">
                  <p><strong>Impact attendu:</strong> {{ rec.impactAttendu }}</p>
                  <p><strong>Délai estimé:</strong> {{ rec.delaiEstime }}</p>
                </div>
              </div>
            </div>
            <ng-template #noRecommendations>
              <p class="no-data">Aucune recommandation disponible</p>
            </ng-template>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Tendances et Optimisations -->
      <div class="analysis-row">
        <!-- Analyse des tendances -->
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>trending_up</mat-icon>
              Analyse des Tendances
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="trends-list" *ngIf="tendances.length > 0; else noTrends">
              <div *ngFor="let tendance of tendances" class="trend-item">
                <div class="trend-header">
                  <mat-icon [style.color]="getTendanceColor(tendance.tendance)">
                    {{ getTendanceIcon(tendance.tendance) }}
                  </mat-icon>
                  <span class="trend-period">{{ tendance.periode }}</span>
                  <span class="trend-value">{{ tendance.valeur | number:'1.0-1' }}</span>
                </div>
                <p class="trend-variation">
                  Variation: {{ tendance.variation > 0 ? '+' : '' }}{{ tendance.variation | number:'1.1-1' }}%
                </p>
                <p class="trend-explanation">{{ tendance.explication }}</p>
              </div>
            </div>
            <ng-template #noTrends>
              <p class="no-data">Aucune tendance analysée</p>
            </ng-template>
          </mat-card-content>
        </mat-card>

        <!-- Optimisations de processus -->
        <mat-card class="analysis-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>speed</mat-icon>
              Optimisations de Processus
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="optimizations-list" *ngIf="optimisations.length > 0; else noOptimizations">
              <div *ngFor="let opt of optimisations" class="optimization-item">
                <h4 class="opt-process">{{ opt.processus }}</h4>
                <div class="efficiency-comparison">
                  <div class="efficiency-bar">
                    <div class="current-efficiency" [style.width]="opt.efficaciteActuelle + '%'">
                      {{ opt.efficaciteActuelle | number:'1.0-0' }}%
                    </div>
                    <div class="optimal-efficiency" [style.width]="(opt.efficaciteOptimale - opt.efficaciteActuelle) + '%'">
                      → {{ opt.efficaciteOptimale | number:'1.0-0' }}%
                    </div>
                  </div>
                </div>
                <div class="gains-potentiels">
                  <h5>Gains potentiels:</h5>
                  <ul>
                    <li *ngFor="let gain of opt.gainsPotentiels">{{ gain }}</li>
                  </ul>
                </div>
                <div class="actions-optimization">
                  <h5>Actions d'optimisation:</h5>
                  <ul>
                    <li *ngFor="let action of opt.actionsOptimisation">{{ action }}</li>
                  </ul>
                </div>
                <p class="implementation-delay">
                  <strong>Délai d'implémentation:</strong> {{ opt.delaiImplementation }}
                </p>
              </div>
            </div>
            <ng-template #noOptimizations>
              <p class="no-data">Aucune optimisation disponible</p>
            </ng-template>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Données récentes -->
    <div class="recent-data-section">
      <div class="data-row">
        <!-- Fiches récentes -->
        <mat-card class="data-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>schedule</mat-icon>
              Fiches Qualité Récentes
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="getFichesRecentes()" class="data-table">
              <ng-container matColumnDef="titre">
                <th mat-header-cell *matHeaderCellDef>Titre</th>
                <td mat-cell *matCellDef="let fiche">{{ fiche.titre }}</td>
              </ng-container>
              <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let fiche">{{ fiche.typeFiche || 'Non défini' }}</td>
              </ng-container>
              <ng-container matColumnDef="statut">
                <th mat-header-cell *matHeaderCellDef>Statut</th>
                <td mat-cell *matCellDef="let fiche">
                  <mat-chip [color]="fiche.statut === 'TERMINE' ? 'accent' : 'primary'" selected>
                    {{ fiche.statut }}
                  </mat-chip>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['titre', 'type', 'statut']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['titre', 'type', 'statut'];"></tr>
            </table>
          </mat-card-content>
        </mat-card>

        <!-- Fiches problématiques -->
        <mat-card class="data-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>warning</mat-icon>
              Fiches Problématiques
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="getFichesProblematiques()" class="data-table">
              <ng-container matColumnDef="titre">
                <th mat-header-cell *matHeaderCellDef>Titre</th>
                <td mat-cell *matCellDef="let fiche">{{ fiche.titre }}</td>
              </ng-container>
              <ng-container matColumnDef="responsable">
                <th mat-header-cell *matHeaderCellDef>Responsable</th>
                <td mat-cell *matCellDef="let fiche">{{ fiche.responsable }}</td>
              </ng-container>
              <ng-container matColumnDef="priorite">
                <th mat-header-cell *matHeaderCellDef>Priorité</th>
                <td mat-cell *matCellDef="let fiche">
                  <mat-chip color="warn" selected>Élevée</mat-chip>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['titre', 'responsable', 'priorite']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['titre', 'responsable', 'priorite'];"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Résumé IA -->
    <mat-card class="ai-summary-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>psychology</mat-icon>
          Résumé des Analyses IA
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="ai-summary">
          <div class="summary-item" *ngIf="alertesCritiques > 0">
            <mat-icon color="warn">priority_high</mat-icon>
            <span>{{ alertesCritiques }} alerte(s) critique(s) nécessitent une attention immédiate.</span>
          </div>
          <div class="summary-item" *ngIf="recommandations.length > 0">
            <mat-icon color="primary">lightbulb</mat-icon>
            <span>{{ recommandations.length }} recommandation(s) IA disponible(s) pour améliorer les processus.</span>
          </div>
          <div class="summary-item" *ngIf="optimisations.length > 0">
            <mat-icon color="accent">speed</mat-icon>
            <span>{{ optimisations.length }} opportunité(s) d'optimisation identifiée(s) par l'IA.</span>
          </div>
          <div class="summary-item" *ngIf="scoreIA >= 80">
            <mat-icon color="primary">check_circle</mat-icon>
            <span>Excellent ! Le score IA est élevé, les analyses sont fiables.</span>
          </div>
          <div class="summary-item" *ngIf="scoreIA < 60">
            <mat-icon color="warn">info</mat-icon>
            <span>Le score IA est faible, plus de données sont nécessaires pour des analyses précises.</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div> 